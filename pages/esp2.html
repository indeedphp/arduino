<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ardylab</title>
  <link rel="shortcut icon"href="../images/myicon.ico">
  <link rel="stylesheet" href="../style.css">
</head>
<body>

  <div class="divdiv"><a href="../index.html"><img src="../images/logo.jpg" class="leftfoto"  ></a><p> Здесь расположены небольшие скетчи (прошивки) для esp8266 для быстрой проверки различных плат и пр.</p></div>

<div class="divdiv te ">
<nobr class="pagination"><a href=" ../pages/esp.html" class="te" style = "color:White"> 1 </a></nobr>
<nobr class="pagination color"><a href="../pages/esp2.html" class="te" style = "color:White"> 2 </a></nobr>
<nobr class="pagination"><a href="../pages/esp3.html" class="te" style = "color:White"> 3 </a></nobr>
</div>

  <div class="divdiv di"></a><p>Монитор порта у нас может работать не только на прием из микроконтроллера<a href="../pages/esp.html#bottom"> как в этом примере </a> , но и на отправку сообщений в микроконтроллер. Данная функция очень удобна для различных тестов наших будующих прошивок особенно тогда когда не все элементы управления готовы, например у нас еще нет кнопок но охота поуправлять устройством тогда мы просто подключаем монитор порта на прием и управляем, так же допустим нет термодатчика который передает температуру в цифре и спомощью монитора порта мы можем передать различную температуру и посмотреть как работает наше устройство. В прошивке мы ждем постоянно информацию из монитора порта и как только она приходит такая как мы хотим срабатывает светодиод на плате, на ЕСП светодиод инвертируемый и это означает как только мы подадим на него питание то он потухнет, а как питание пропадет светодиод загорится. Число можно передавать любое, например 53 как у нас в прошивке, и таким образом мы можем управлять хоть сотней действий на плате, единственное кроме нуля так как ноль и так все время передается</p>

<pre class="ide"><code><span class="ide-keyword">void</span> <span class="ide-system-keyword">setup</span>() {                    <span class="ide-line-comment">// функция настроек и разового ввода данных</span>
  <span class="ide-platform-class">Serial</span>.<span class="ide-platform-function">begin</span> (115200);          <span class="ide-line-comment">// выставляем скорость на порту</span>
  <span class="ide-platform-function">pinMode</span>(D4, <span class="ide-keyword">OUTPUT</span>);            <span class="ide-line-comment">// инициализация контакта Wemos D1 Mini светодиод на GPIO2 (D4)</span>
}
<span class="ide-keyword">void</span> <span class="ide-system-keyword">loop</span>() {                     <span class="ide-line-comment">// запускаем бесконечную обработку кода (цикл)</span>
  <span class="ide-system-keyword">if</span> (<span class="ide-platform-class">Serial</span>.parseInt() == 53) {  <span class="ide-line-comment">// Если (Число из монитора порта = 53) то выполняем команды до конца скобки</span>
    <span class="ide-platform-function">digitalWrite</span>(D4, 1);          <span class="ide-line-comment">// На пине D4 к которому подключен светодиод устанавливаем 1 это +3.3 вольтa</span>
    <span class="ide-platform-function">delay</span>(2000);                  <span class="ide-line-comment">// ждем 2000 милисекунд - 2 секунды</span>
    <span class="ide-platform-function">digitalWrite</span>(D4, 0);          <span class="ide-line-comment">// На пине D4 к которому подключен светодиод устанавливаем 0 это 0 вольт</span>
  }                               <span class="ide-line-comment">// команды из if выполняются до этой скобки</span>
}
</code></pre>

<img src="../images/esp_serial_out.jpg" class="foc" tabindex="1">
</div>


<div class="divdiv di"></a><p>Для плавного включения и работы в различных режимах используют ШИМ, многих он бесит в экранах смартфонов, но это самый простой способ регулирования мощности.  ШИМ можно применить для регулировки скорости и плавного набора скорости различых моторов, например квадрокоптеров, можно изменять свечение ламп и светодиодов, регулировать нагрев, например паяльника, утюга или электроплитки, а так же с помощью ШИМ можно предавать информацию о работе, например с помощью ШИМ передают информацию о давлении некоторые датчики фреона в автомобиле. ШИМ в есп реализован довольно просто, можно использовать почти все пины для этого и регулировать частоту в приличных пределах. В нашем скетче мы будем управлять встроенным светодиодом, для начала выставим частоту в 100 герц и настроим выход на пин д4, затем в цикле включим ШИМ на пине д4 и выставим скважность. Скважность это  то чем управляет шим сигнал, чем больше скважность тем больше мощности передается на устройство, смотрите рисунок ниже, но в есп светодиод у нас инверсный он будет показывать все наоборот.  </p>
  <a name="esp_pwm"></a>

<pre class="ide"><code><span class="ide-keyword">void</span> <span class="ide-system-keyword">setup</span>()              <span class="ide-line-comment">// функция настроек и разового ввода данных</span>
  {
    analogWriteFreq(100); <span class="ide-line-comment">// выставляем частоту (100.. 40000 Гц)</span>
    <span class="ide-platform-function">pinMode</span>(D4, <span class="ide-keyword">OUTPUT</span>);  <span class="ide-line-comment">// д4 пин настраиваем на выход</span>
  }
<span class="ide-keyword">void</span> <span class="ide-system-keyword">loop</span>()               <span class="ide-line-comment">// запускаем бесконечную обработку кода (цикл)</span>
  {
    <span class="ide-platform-function">analogWrite</span>(D4, 175); <span class="ide-line-comment">//включаем работу шим на пин д4, 0-255 скважность</span>
  }
</code></pre>

<img src="../images/esp_pwm.jpg" class="foc" tabindex="1">
</div>


<div class="divdiv di"></a><p> Давайте измерим с помощью ЕСП частоту, этот пример поможет делать различные спидометры, тахометры и пр. В прошлом примере мы генерировали ШИМ сигнал давайте померяем его частоту, придется обьеденить два скетча один  <a href="../pages/esp.html#esp_random_serial">про монитор порта </a>, а второй <a href="../pages/esp2.html#esp_pwm"> про шим сигнал </a>  с новыми функциями, таким образом мы будем создавать сигнал, измерять его и выводить в монитор порта с одной платы ЕСП. Для измерениянам пригодится такая функция pulseIn( ) которая будет измерять время сигнала в микросекундах на том пине который мы захотим, далее мы выведем полученый реультат в монитор порта. Можно доработать данную прошивку и она будет измерять и скважность, потом собрать схемку преобразователя сигнала в прямоугольные импульсы 3.3 вольта и у нас получится отличный частотомер с измерением скважности, далее можно вывести информацию на отдельный экранчик и подключить аккумулятор - будет неплохое автономное устройство для измерения и генерирования шим сигнала!</p>

<pre class="ide"><code>{
  <span class="ide-platform-class">Serial</span>.<span class="ide-platform-function">begin</span>(9600);        <span class="ide-line-comment">// выставляем скорость на порту</span>
  <span class="ide-platform-function">pinMode</span>(D2, <span class="ide-keyword">INPUT</span>);        <span class="ide-line-comment">// д4 пин настраиваем на выход</span>
  <span class="ide-platform-function">pinMode</span>(D4, <span class="ide-keyword">OUTPUT</span>);       <span class="ide-line-comment">// д4 пин настраиваем на выход</span>
  analogWriteFreq(1000);     <span class="ide-line-comment">// выставляем частоту (100.. 40000 Гц)</span>
}
<span class="ide-keyword">void</span> <span class="ide-system-keyword">loop</span>()                  <span class="ide-line-comment">// запускаем бесконечную обработку кода (цикл)</span>
{
  <span class="ide-platform-function">analogWrite</span>(D4, 127);      <span class="ide-line-comment">//включаем работу шим на пин д4, 0-255 скважность (127 = 50% скважность)</span>
  Htime = pulseIn(D2, <span class="ide-keyword">HIGH</span>); <span class="ide-line-comment">// прочитать время высокого логического уровня</span>
  Ltime = pulseIn(D2, <span class="ide-keyword">LOW</span>);  <span class="ide-line-comment">// прочитать время низкого логического уровня</span>
  Ttime = Htime + Ltime;     <span class="ide-line-comment">// складываем низкий и высокий лочический уровень</span>
  frequency=1000000/Ttime;   <span class="ide-line-comment">// получение частоты из микросекунд</span>
  <span class="ide-platform-class">Serial</span>.<span class="ide-platform-function">println</span>(frequency); <span class="ide-line-comment">// выводим в монитор порта результат</span>
  <span class="ide-platform-function">delay</span>(2000);               <span class="ide-line-comment">// ожидание в течение 2 секунд</span>
}
</code></pre>

<img src="../images/esp_pwm_frequency.jpg" class="foc" tabindex="1">
</div>


<div class="divdiv te ">
<nobr class="pagination"><a href=" ../pages/esp.html" class="te" style = "color:White"> 1 </a></nobr>
<nobr class="pagination color"><a href="../pages/esp2.html" class="te" style = "color:White"> 2 </a></nobr>
<nobr class="pagination"><a href="../pages/esp3.html" class="te" style = "color:White"> 3 </a></nobr>
</div>





</body>
</html>


