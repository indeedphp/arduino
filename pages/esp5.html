<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ardylab</title>
  <link rel="shortcut icon"href="../images/myicon.ico">
  <link rel="stylesheet" href="../style.css">
</head>
<body>

  <header>
    <table width="1250" >
     <tr>
      <td width="150"><a href="../index.html"><img src="../images/logo.jpg" class="leftfoto"></a></td>

      <td width="700"><p>Здесь расположены небольшие скетчи (прошивки) для esp8266 для быстрой проверки различных плат и пр.</p></td>

      <td>
        <div>
          <select class="box" onchange="document.location=this.options[this.selectedIndex].value" >
            <option value=""> Оглавление </option>
            <option VALUE="../pages/esp.html#esp_blink">Мигание светодиодом</option>
            <option VALUE="../pages/esp.html#speaker_k_esp">Подключение пищалки</option>
            <option VALUE="../pages/esp.html#esp_random_serial">Монитор порта и случайное число</option>
            <option VALUE="../pages/esp.html#esp_analog">Аналоговый порт АЦП</option>
            <option VALUE="../pages/esp.html#esp_button">Подключение кнопки</option>
            <option VALUE="../pages/esp2.html#esp_serial_out">Управление с монитора порта</option>
            <option VALUE="../pages/esp2.html#esp_pwm">Широтно импульсная модуляция ШИМ</option>
            <option VALUE="../pages/esp2.html#esp_pwm_frequency">Измеритель частоты</option>
            <option VALUE="../pages/esp2.html#esp_EEPROM_write">Запись в EEPROM</option>
            <option VALUE="../pages/esp2.html#esp_EEPROM_read">Чтение из EEPROM</option>
            <option VALUE="../pages/esp3.html#esp_interrupt">Прерывания в WeMos D1 mini</option>
            <option VALUE="../pages/esp3.html#esp_oled_Hello world">Подключаем дисплей OLED 128x64</option>
            <option VALUE="../pages/esp3.html#esp_IR_control">Подключаем ИК приемник Д.У.</option>
            <option VALUE="../pages/esp3.html#esp_IR_control_blink">Управляем с ИК Д.У. </option>
            <option VALUE="../pages/esp3.html#esp_ibutton">Считываем код ключа ibutton</option>
            <option VALUE="../pages/esp4.html#esp_ibutton_blink">Работаем с ключем ibutton</option>
            <option VALUE="../pages/esp4.html#esp_PWM_blink">Подключаем транзистор MOSFET</option>
            <option VALUE="../pages/esp4.html#esp_PWM_blink_smoothly">Плавный пуск на MOSFETе</option>
            <option VALUE="../pages/esp4.html#esp_433_Receive">Считываем коды пульта 433Мгц</option>
            <option VALUE="../pages/esp4.html#esp_433_Receive_blink">Управляем пультом 433Мгц</option>
            <option VALUE="../pages/esp5.html#esp_wifi_server_ap">WiFi сервер на WeMos D1 mini</option>
          </select></div>
        </div></td>
      </tr>
    </table>
  </header>


  <div class="divdiv d">
   <a href="../pages/esp.html" class="pagination">1</a>
   <a href="../pages/esp2.html" class="pagination">2</a>
   <a href="../pages/esp3.html" class="pagination">3</a>
   <a href="../pages/esp4.html" class="pagination">4</a>
   <a href="../pages/esp5.html" class="pagination color">5</a>
 </div>

 <div class="divdiv di"><a name="esp_wifi_server_ap"></a><p>Настраиваем WiFi сервер на точке доступа в ЕСП. Сервер это просто программа которая отвечает на наши запросы в сети, сервер хорош тем что просто позволяет из браузера компьютера или смартфона управлять устройствами на ЕСП напрямую. Мы можем управлять и получать данные от умного дома(включать свет, открывать замок, получать расход воды и пр.) автомобилем (центральный замок, стекла, автозапуск, получать температуру двигателя и пр.), а можно просто управлять игрушкой по WiFi.<br/> Мы будем управлять встроенным в ЕСП светодиодом, для этого загружаем в ЕСП наш скетч и подключаемся с ноутбука или смартфона к WiFi точке "WIFI_ESP9266" и вводим пароль "password", далее открываем браузер и адресную строку вводим адрес с запросом http://192.168.4.1:8080/?dir=1 (после ? заканчивается адрес и начинается запрос) и светодиод на плате погаснет а на пине д4 появится +3.3 вольта и мы увидим об этом сообщение текстом, дальше в браузере вводим  http://192.168.4.1:8080/?dir=2 и светодиод загорается и мы также увидим об этом сообщение текстом, а на пине д4 у нас 0 вольт.<br/> Конечно вводить команды не удобно но можно сделать простое приложение в онлайн конструкторе которое будет при нажатии кнопки отправлять запрос и получать текст, об этом есть информация в интернете. Минус сервера в том что сами данные не придут пока мы не сделаем запрос, например что то произойдет например сильно упадет температура в помещении и мы об этом не узнаем, в следующем примере настроим клиента вместо сервера который будет отсылать переодично данные (но это намного сложнее ведь гдето надо данные эти получать).</p>


<pre class="ide"><code>
<span class="ide-system-keyword">#include</span> &lt;<span class="ide-platform-function">ESP8266WiFi</span>.h&gt;              <span class="ide-line-comment">// подключаем WiFi библиотеку ESP8266WiFi.h</span>
<span class="ide-system-keyword">#include</span> &lt;<span class="ide-platform-class">ESP8266WebServer</span>.h&gt;         <span class="ide-line-comment">// подключаем библиотеку веб сервера ESP8266WebServer.h</span>
<span class="ide-keyword">const</span> <span class="ide-keyword">char</span> *ssid = <span class="ide-string">&quot;WIFI_ESP9266&quot;</span>;    <span class="ide-line-comment">// название точки доступа</span>
<span class="ide-keyword">const</span> <span class="ide-keyword">char</span> *password = <span class="ide-string">&quot;password&quot;</span>;    <span class="ide-line-comment">// пароль</span>
<span class="ide-platform-class">IPAddress</span> ip(192, 168, 4, 1);         <span class="ide-line-comment">// адрес айпи</span>
<span class="ide-platform-class">IPAddress</span> netmask(255, 255, 255, 0);  <span class="ide-line-comment">// маска</span>
<span class="ide-keyword">const</span> <span class="ide-keyword">int</span> port = 8080;                <span class="ide-line-comment">// порт</span>
<span class="ide-platform-class">ESP8266WebServer</span> server(port);        <span class="ide-line-comment">// выставляем порт </span>
<span class="ide-keyword">void</span> <span class="ide-system-keyword">setup</span>() {                        <span class="ide-line-comment">// функция настроек и разового ввода данных</span>
  <span class="ide-platform-class">WiFi</span>.<span class="ide-platform-function">mode</span>(WIFI_AP);                 <span class="ide-line-comment">// настройка вай фай как точки доступа</span>
  <span class="ide-platform-class">WiFi</span>.<span class="ide-platform-function">softAPConfig</span>(ip, ip, netmask); <span class="ide-line-comment">// настраиваем в сервере адрес</span>
  <span class="ide-platform-class">WiFi</span>.<span class="ide-platform-function">softAP</span>(ssid, password);        <span class="ide-line-comment">// настройки пароль и имя</span>
  <span class="ide-platform-function">pinMode</span>(D4, <span class="ide-keyword">OUTPUT</span>);                <span class="ide-line-comment">// пин светодиода на выход</span>
  server.<span class="ide-platform-function">on</span>(<span class="ide-string">&quot;/&quot;</span>, HTTP_GET, <span class="ide-system-keyword">loop</span>);     <span class="ide-line-comment">// в запросе после /, смотрим гет запрос, в функции loop</span>
  server.<span class="ide-platform-function">begin</span>();                     <span class="ide-line-comment">// включить сервер</span>
}
<span class="ide-keyword">void</span> <span class="ide-system-keyword">loop</span>() {                         <span class="ide-line-comment">// запускаем бесконечную обработку кода (цикл)</span>
  server.<span class="ide-platform-function">handleClient</span>();              <span class="ide-line-comment">// обрабатываем клиентский запрос (запрос с браузера)</span>
  <span class="ide-keyword">String</span> type = server.<span class="ide-platform-function">arg</span>(<span class="ide-string">&quot;dir&quot;</span>);    <span class="ide-line-comment">// в запросе с ключем dir смотрим значение</span>
  <span class="ide-line-comment">//----------1 условие----------</span>
  <span class="ide-system-keyword">if</span> (type.equals(<span class="ide-string">&quot;1&quot;</span>)) {             <span class="ide-line-comment">// если в запросе 1 то</span>
    <span class="ide-platform-function">digitalWrite</span>(D4, 1);              <span class="ide-line-comment">// светодиод на плате выключаем, пин д4 +3.3 вольта</span>
    <span class="ide-platform-function">delay</span> (1000);                     <span class="ide-line-comment">// пауза 1 секунда</span>
    server.<span class="ide-platform-function">send</span>(200, <span class="ide-string">&quot;text / plain&quot;</span>,  <span class="ide-string">&quot;LED OFF pin D4 +3.3volt&quot;</span>); <span class="ide-line-comment">// ответ сервера что все ок и текст в формате text / plain</span>
  }
  <span class="ide-line-comment">//----------2 условие----------</span>
  <span class="ide-system-keyword">if</span> (type.equals(<span class="ide-string">&quot;2&quot;</span>)) {             <span class="ide-line-comment">// если в запросе 2 то</span>
    <span class="ide-platform-function">digitalWrite</span>(D4, 0);              <span class="ide-line-comment">// светодиод на плате включаем, пин д4 0 вольт</span>
    <span class="ide-platform-function">delay</span> (1000);                     <span class="ide-line-comment">// пауза 1 секунда</span>
    server.<span class="ide-platform-function">send</span>(200, <span class="ide-string">&quot;text / plain&quot;</span>,  <span class="ide-string">&quot;LED ON pin D4 0volt&quot;</span>);     <span class="ide-line-comment">// ответ сервера что все ок и текст в формате text / plain</span>
  }
}

</code></pre>

<br/>
<p> В браузере после подключения к WIFI_ESP9266 вводим адрес с запросом.</p>
<img src="../images/esp_wifi_server_ap.jpg" class="foc" tabindex="1">

</div>


<div class="divdiv d">
 <a href="../pages/esp.html" class="pagination">1</a>
 <a href="../pages/esp2.html" class="pagination">2</a>
 <a href="../pages/esp3.html" class="pagination">3</a>
 <a href="../pages/esp4.html" class="pagination">4</a>
 <a href="../pages/esp5.html" class="pagination color">5</a>
</div>
<footer>

</footer>
</body>
</html>


